<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Zhongrui Li, godlzr@gmail.com"><title>SQL 其他 · 1285 Richmond RD</title><meta name="description" content="###    1、索引
索引是一种与表有关的结构，它的作用相当于书的目录，可以根据目录中的页码快速找到所需的内容。 当表中有大量记录时，若要对表进行查询，没有索引的情况是全表搜索：将所有记录一一取出，和查询条件进行一一对比，然后返回满足条件的记录。这样做会消耗大量数据库系统时间，并造成大量磁盘I/O"><meta name="keywords" content="Hexo,HTML,Ben,CSS,安卓,android,Linux,linuxdeepin"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">1285 Richmond RD</a></h3><div class="description"><p>Youth is waste on the young</p></div></div></div><ul class="social-links"><li><a href="https://github.com/godlzr"><i class="fa fa-github"></i></a></li><li><a href="http://instagram.com/ggooddlzr"><i class="fa fa-instagram"></i></a></li><li><a href="https://twitter.com/godlzr"><i class="fa fa-twitter"></i></a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><a target="_blank" href="/"></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Prowered by Hexo| Theme </a><a href="https://github.com/Ben02/hexo-theme-Anatole">Anatole</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="https://s.gravatar.com/avatar/04faa079dab07fdebe362ed828ecc186?s=80"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>SQL 其他</a></h3></div><div class="post-content"><p>###<br>    1、索引</p>
<pre><code>索引是一种与表有关的结构，它的作用相当于书的目录，可以根据目录中的页码快速找到所需的内容。 当表中有大量记录时，若要对表进行查询，没有索引的情况是全表搜索：将所有记录一一取出，和查询条件进行一一对比，然后返回满足条件的记录。这样做会消耗大量数据库系统时间，并造成大量磁盘I/O操作。 而如果在表中已建立索引，在索引中找到符合查询条件的索引值，通过索引值就可以快速找到表中的数据，可以**大大加快查询速度**。

对一张表中的某个列建立索引，有以下两种语句格式：
</code></pre><pre>
`<span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名字 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> 索引名 (列名);</span>

<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> 索引名 <span class="hljs-keyword">ON</span> 表名字 (列名);</span>
`</pre>

<pre><code>我们用这两种语句分别建立索引：
</code></pre><pre>
`<span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> employee <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> idx_id (id);</span>  #在employee表的id列上建立名为idx_id的索引

<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_name <span class="hljs-keyword">ON</span> employee (name);</span>   #在employee表的name列上建立名为idx_name的索引
`</pre>

<pre><code>索引的效果是加快查询速度，当表中数据不够多的时候是感受不出它的效果的。这里我们使用命令 **SHOW INDEX FROM 表名字;** 查看刚才新建的索引：

![01](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-01.png)

在使用SELECT语句查询的时候，语句中WHERE里面的条件，会**自动判断有没有可用的索引**。
</code></pre><p>###<br>    2、视图</p>
<pre><code>视图是从一个或多个表中导出来的表，是一种**虚拟存在的表**。它就像一个窗口，通过这个窗口可以看到系统专门提供的数据，这样，用户可以不用看到整个数据库中的数据，而只关心对自己有用的数据。

注意理解视图是虚拟的表：
</code></pre><ul>
<li>数据库中只存放了视图的定义，而没有存放视图中的数据，这些数据存放在原来的表中；</li>
<li>使用视图查询数据时，数据库系统会从原来的表中取出对应的数据；</li>
<li>视图中的数据依赖于原来表中的数据，一旦表中数据发生改变，显示在视图中的数据也会发生改变；</li>
<li><p>在使用视图的时候，可以把它当作一张表。</p>
<p>创建视图的语句格式为：</p>
</li>
</ul>
<pre>
`<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> 视图名(列a,列b,列c) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> 列<span class="hljs-number">1</span>,列<span class="hljs-number">2</span>,列<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> 表名字;</span>
`</pre>

<pre><code>可见创建视图的语句，后半句是一个SELECT查询语句，所以**视图也可以建立在多张表上**，只需在SELECT语句中使用**子查询**或**连接查询**，这些在之前的实验已经进行过。

现在我们创建一个简单的视图，名为 **v_emp**，包含**v_name**，**v_age**，**v_phone**三个列：

![02](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-02.png/logoblackfont)
</code></pre><p>###<br>    3、导入</p>
<pre><code>导入操作，可以把一个文件里的数据保存进一张表。导入语句格式为：
</code></pre><pre>
`<span class="hljs-operator"><span class="hljs-keyword">LOAD</span> <span class="hljs-keyword">DATA</span> <span class="hljs-keyword">INFILE</span> <span class="hljs-string">&#39;文件路径&#39;</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> 表名字;</span>
`</pre>

<pre><code>现在 /tmp/SQL6 目录下有一个名为 **in.txt** 的文件，我们尝试把这个文件中的数据导入数据库 **mysql_shiyan** 的 **employee** 表中。

先按住 **Ctrl+Z** 退出MySQL，再使用命令 **gedit /tmp/SQL6/in.txt** 查看 **test.txt** 文件中的内容：

![03](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-03.png)

再使用以下命令以root用户登录数据库，再连接 **mysql_shiyan** 数据库：
</code></pre><pre>
`<span class="hljs-title">mysql</span> -u root

use mysql_shiyan
`</pre>

<pre><code>查看一下没有导入数据之前，employee表中的数据：

![04](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-04.png)

现在执行导入语句，文件中的数据成功导入employee表：

![05](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-05.png/logoblackfont)
</code></pre><p>###<br>    4、导出</p>
<pre><code>导出与导入是相反的过程，是把数据库某个表中的数据保存到一个文件之中。导出语句基本格式为：
</code></pre><pre>
`<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> 列<span class="hljs-number">1</span>，列<span class="hljs-number">2</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">OUTFILE</span> <span class="hljs-string">&#39;文件路径和文件名&#39;</span> <span class="hljs-keyword">FROM</span> 表名字;</span>
`</pre>

<pre><code>**注意：语句中 &amp;ldquo;文件路径&amp;rdquo; 之下不能已经有同名文件。**

现在我们把整个employee表的数据导出到 /tmp 目录下，导出文件命名为 **out.txt** 具体语句为：
</code></pre><pre>
`<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">OUTFILE</span> <span class="hljs-string">&#39;/tmp/out.txt&#39;</span> <span class="hljs-keyword">FROM</span> employee;</span>
`</pre>

<pre><code>用gedit可以查看导出文件 out.txt 的内容：

![06](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-06.png/logoblackfont)
</code></pre><p>###<br>    5、备份</p>
<pre><code>数据库中的数据或许十分重要，出于安全性考虑，在数据库的使用中，应该注意使用备份功能。
</code></pre><blockquote>
<p>备份与导出的区别：导出的文件只是保存数据库中的数据；而备份，则是把数据库的结构，包括数据、约束、索引、视图等全部另存为一个文件。</p>
</blockquote>
<pre><code>**mysqldump**是MySQL用于备份数据库的实用程序。它主要产生一个SQL脚本文件，其中包含从头重新创建数据库所必需的命令CREATE TABLE INSERT等。

使用mysqldump备份的语句：
</code></pre><pre>
`<span class="hljs-title">mysqldump</span> -u root 数据库名&gt;备份文件名;   <span class="hljs-comment">#备份整个数据库</span>

<span class="hljs-title">mysqldump</span> -u root 数据库名 表名字&gt;备份文件名;  <span class="hljs-comment">#备份整个表</span>
`</pre>

<pre><code>我们尝试备份整个数据库 **mysql_shiyan**，将备份文件命名为 **bak.sql**，先 **Ctrl+Z** 退出MySQL，再使用语句：
</code></pre><pre>
`<span class="hljs-title">mysqldump</span> -u root mysql_shiyan &gt; bak.sql;
`</pre>

<pre><code>使用命令&amp;ldquo;ls&amp;rdquo;可见已经生成备份文件bak.sql：

![07](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-07.png/logoblackfont)
</code></pre><blockquote>
<p>你可以用gedit查看备份文件的内容，可以看见里面不止保存了数据，还有所备份的数据库的其他信息。</p>
</blockquote>
<p>###<br>    6、恢复</p>
<pre><code>用备份文件恢复数据库，其实我们早就使用过了。在本次实验的开始，我们使用过这样一条命令：
</code></pre><pre>
`<span class="hljs-built_in">source</span> /tmp/SQL6/MySQL-<span class="hljs-number">06</span>.sql
`</pre>

<pre><code>这就是一条恢复语句，它把MySQL-06.sql文件中保存的mysql_shiyan数据库恢复。

还有另一种方式恢复数据库，但是在这之前我们先使用命令新建一个**空的数据库 test**：
</code></pre><pre>
`mysql -u root          <span class="hljs-comment">#因为在上一步已经退出了MySQL，现在需要重新登录</span>

CREATE DATABASE <span class="hljs-built_in">test</span>;  <span class="hljs-comment">#新建一个名为test的数据库</span>
`</pre>

<pre><code>再次 **Ctrl+Z** 退出MySQL，然后输入语句进行恢复，把刚才备份的 **bak.sql** 恢复到**test** 数据库：
</code></pre><pre>
`mysql -u root <span class="hljs-built_in">test</span> &lt; bak.sql
`</pre>

<pre><code>我们输入命令查看tset数据库的表，便可验证是否恢复成功：
</code></pre><pre>
`mysql -u root          <span class="hljs-comment">#因为在上一步已经退出了MySQL，现在需要重新登录</span>

use <span class="hljs-built_in">test</span>               <span class="hljs-comment">#连接数据库test</span>

SHOW TABLES;           <span class="hljs-comment">#查看test数据库的表</span>
`</pre>

<pre><code>可以看见原数据库的4张表和1个视图，现在已经恢复到test数据库中：

![08](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-08.png/logoblackfont)

再查看employee表的恢复情况：

![09](https://dn-anything-about-doc.qbox.me/MySQL/sql-06-09.png/logoblackfont)
</code></pre></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2015-05-27</span><i class="fa fa-tag"></i><a href="/categories/SQL/" title="SQL" class="tag">SQL </a></div></div></div></div><div class="share"><div class="evernote"> <a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"> <a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"> <a href="http://twitter.com/home?status=,http://godlzr.com/2015/05/27/sql-others/,1285 Richmond RD,SQL 其他,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2015/05/27/sql-select/" title="SQL Select" class="btn">prev_post</a></li><li class="next pagbuttons"><a role="navigation" href="/2015/05/27/sql-mod-del-2/" title="SQL 修改和删除" class="btn">next_post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>