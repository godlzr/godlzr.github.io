<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      1.Singleton 单例模式 | 1285 RICHMOND ROAD
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Zhongrui Li">
    
    

    <meta name="description" content="1.单例模式，一个类只有一个对象，并且提供一个访问该实例的全局访问点
&amp;lt;span id=&amp;quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb">
<meta property="og:type" content="article">
<meta property="og:title" content="1.Singleton 单例模式 | 1285 RICHMOND ROAD">
<meta property="og:url" content="http://yoursite.com/2015/08/13/singleton/index.html">
<meta property="og:site_name" content="1285 RICHMOND ROAD">
<meta property="og:description" content="1.单例模式，一个类只有一个对象，并且提供一个访问该实例的全局访问点
&amp;lt;span id=&amp;quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb">
<meta property="og:updated_time" content="2016-06-24T03:45:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="1.Singleton 单例模式 | 1285 RICHMOND ROAD">
<meta name="twitter:description" content="1.单例模式，一个类只有一个对象，并且提供一个访问该实例的全局访问点
&amp;lt;span id=&amp;quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb">

    
    
      <link rel="icon" type="image/x-icon" href="./images/icon.jpg">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">


    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">1285 RICHMOND ROAD</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          GODLZR&#39;s Blog
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Home</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">About</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">Archive</a></li>
              

            </ul>
          </nav>

          <partial('_partials/social') >

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">1.Singleton 单例模式</h1>

    

    <div class="post-meta">
      <time datetime="2015-08-13" class="post-meta__date date">2015-08-13</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/Creational-Patterns/">Creational Patterns</a>
            </font>
          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 255); font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">1.<a href="https://github.com/godlzr/GOF23_DesignPattern/tree/master/src/com/godlzr/GOF23/singleton" target="_blank" rel="external">单例模式</a>，一个类只有一个对象，并且提供一个访问该实例的全局访问点</span></span></p>
<pre><code>&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;例如，windows的任务管理器，回收站。&lt;/span&gt;&lt;/span&gt;

&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;调用效率，线程安全，懒加载&lt;/span&gt;&lt;/span&gt;

&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;优点：只有一个实例，内存占用和系统开销小，&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">饿汉式：</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;线程安全，调用效率高，不能延时加载&lt;/span&gt;&lt;/span&gt;
</code></pre></li>
</ul>
<pre class="brush:java;">
/*
 * 测试饿汉式单例模式
 */
public class SingletonDemo1 {

    //由于加载类时天然的线程安全
    private static SingletonDemo1 instance = new SingletonDemo1();//2.类初始化时立即直接构造函数实例（饿汉式）（没有延时加载的优势）

    private SingletonDemo1(){
    }//1.构造函数私有化

    //方法没有同步，调用效率高
    public static SingletonDemo1 getInstance(){
        return instance;
    }//3.实例唯一的访问方法
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">懒汉式：</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;线程安全，调用效率低，延时加载（懒加载，只有用的时候才new实例),&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">需要同步，并发效率低。</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 单例模式懒汉式
 */
public class SingletonDemo2 {

    private static SingletonDemo2 instance;//2.类初始化时不初始化对象实例，延时加载，真正使用的时候再加载

    private SingletonDemo2(){ }//1.构造函数私有化

    //4.SYNCHRONIZED 需要同步，调用效率低，保证同一时间只有一个线程访问获取实例函数，这样就不会有多个实例被创建
    public static synchronized SingletonDemo2 getInstance(){
        if( instance == null)
        {
            instance = new SingletonDemo2();//3.使用的时候才真正构造对象实例，加载对象
        }
        return instance;
    } 
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">双重检测锁 double check lock</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;将同步检测放在if下，提高了调用的效率&lt;/span&gt;&lt;/span&gt;
</code></pre></li>
</ul>
<pre class="brush:java;">
/*
 * 双重检查锁实现单例模式
 */
public class SingletonDemo3 {
    private static SingletonDemo3 instance = null;

    private SingletonDemo3(){}

    public static SingletonDemo3 getInstance(){

        if(instance == null){
            SingletonDemo3 sc;
            synchronized (SingletonDemo3.class){
                sc = instance;
                if(sc == null){
                    synchronized (SingletonDemo3.class){
                        if(sc == null){
                            sc = new SingletonDemo3();
                        }
                    }
                    instance  = sc;
                }
            }
        }
        return instance;
    }
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">静态内部类 *（并发高效调用，和延时加载）</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;也是一种懒加载&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">使用静态内部类</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 静态内部类实现单例模式
 * 这种方式线程安全，调用效率高，实现了延时加载
 */

public class SingletonDemo4 {

    //静态内部类
    private static class SingletonClassInstance{
        private static final SingletonDemo4 instance =  new SingletonDemo4();
    }
    private SingletonDemo4(){}

    //方法没有同步，调用效率高
    public static SingletonDemo4 getInstance(){
        return SingletonClassInstance.instance;//调用时才加载静态内部类，并由静态内部类获取实例
    }
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">枚举单例 （最安全）</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;枚举对象天然是单例的&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">天然防止反射和反序列化</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 枚举模式实现单例，枚举没有延时加载
 */
public enum SingletonDemo5 {

    //这个枚举元素本身就是单例
    INSTANCE;
    //添加自己需要的操作
    public void singletonOperation(){
    }
}</pre>

<pre><code>&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;如何选用&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">单例对象 占用资源少 不需要延时加载：枚举 好于 饿汉</span></span></p>
</li>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">单例对象 占用资源多 需要延时加载：静态内部类 好于 懒汉</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">问题</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&nbsp;&nbsp; &nbsp;</span><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/Client2.java" target="_blank" rel="external">反射破解除枚举外的单例模式，</a>（<a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/SingletonDemo6.java" target="_blank" rel="external">在构造器中判断实例是否为空</a>，不是的话抛出异常，不初始化新实例）</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&nbsp;&nbsp; &nbsp;</span><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/Client2.java" target="_blank" rel="external">反序列化破解除枚举外的单例模式</a>。（<a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/SingletonDemo6.java" target="_blank" rel="external">使用 readResolve() 防止</a>）。</span></span></p>
</li>
</ul>

  </section>

  

<section class="post-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'godlzr'; 
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>


    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    <if ( theme.github_repo_widget) {>

    <script src="/js/jquery.githubRepoWidget.min.js"></script>

<}>

    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
