<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Zhongrui Li, godlzr@gmail.com"><title>1.Singleton 单例模式 · 1285 Richmond RD</title><meta name="description" content="1.单例模式，一个类只有一个对象，并且提供一个访问该实例的全局访问点
&amp;lt;span id=&amp;quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;font-size: "><meta name="keywords" content="Hexo,HTML,Ben,CSS,安卓,android,Linux,linuxdeepin"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img border="0" src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">1285 Richmond RD</a></h3><div class="description"><p>Youth is waste on the young</p></div></div></div><ul class="social-links"><li><a href="https://github.com/godlzr"><i class="fa fa-github"></i></a></li><li><a href="http://instagram.com/ggooddlzr"><i class="fa fa-instagram"></i></a></li><li><a href="https://twitter.com/godlzr"><i class="fa fa-twitter"></i></a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><a target="_blank" href="/"></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Prowered by Hexo | Theme </a><a href="https://github.com/Ben02/hexo-theme-Anatole">Anatole</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="https://s.gravatar.com/avatar/04faa079dab07fdebe362ed828ecc186?s=80"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>1.Singleton 单例模式</a></h3></div><div class="post-content"><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 255); font-weight: 700; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">1.<a href="https://github.com/godlzr/GOF23_DesignPattern/tree/master/src/com/godlzr/GOF23/singleton" target="_blank" rel="external">单例模式</a>，一个类只有一个对象，并且提供一个访问该实例的全局访问点</span></span></p>
<pre><code>&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;例如，windows的任务管理器，回收站。&lt;/span&gt;&lt;/span&gt;

&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;调用效率，线程安全，懒加载&lt;/span&gt;&lt;/span&gt;

&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;优点：只有一个实例，内存占用和系统开销小，&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">饿汉式：</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;线程安全，调用效率高，不能延时加载&lt;/span&gt;&lt;/span&gt;
</code></pre></li>
</ul>
<pre class="brush:java;">
/*
 * 测试饿汉式单例模式
 */
public class SingletonDemo1 {

    //由于加载类时天然的线程安全
    private static SingletonDemo1 instance = new SingletonDemo1();//2.类初始化时立即直接构造函数实例（饿汉式）（没有延时加载的优势）

    private SingletonDemo1(){
    }//1.构造函数私有化

    //方法没有同步，调用效率高
    public static SingletonDemo1 getInstance(){
        return instance;
    }//3.实例唯一的访问方法
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">懒汉式：</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;线程安全，调用效率低，延时加载（懒加载，只有用的时候才new实例),&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">需要同步，并发效率低。</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 单例模式懒汉式
 */
public class SingletonDemo2 {

    private static SingletonDemo2 instance;//2.类初始化时不初始化对象实例，延时加载，真正使用的时候再加载

    private SingletonDemo2(){ }//1.构造函数私有化

    //4.SYNCHRONIZED 需要同步，调用效率低，保证同一时间只有一个线程访问获取实例函数，这样就不会有多个实例被创建
    public static synchronized SingletonDemo2 getInstance(){
        if( instance == null)
        {
            instance = new SingletonDemo2();//3.使用的时候才真正构造对象实例，加载对象
        }
        return instance;
    } 
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">双重检测锁 double check lock</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;将同步检测放在if下，提高了调用的效率&lt;/span&gt;&lt;/span&gt;
</code></pre></li>
</ul>
<pre class="brush:java;">
/*
 * 双重检查锁实现单例模式
 */
public class SingletonDemo3 {
    private static SingletonDemo3 instance = null;

    private SingletonDemo3(){}

    public static SingletonDemo3 getInstance(){

        if(instance == null){
            SingletonDemo3 sc;
            synchronized (SingletonDemo3.class){
                sc = instance;
                if(sc == null){
                    synchronized (SingletonDemo3.class){
                        if(sc == null){
                            sc = new SingletonDemo3();
                        }
                    }
                    instance  = sc;
                }
            }
        }
        return instance;
    }
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">静态内部类 *（并发高效调用，和延时加载）</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;也是一种懒加载&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">使用静态内部类</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 静态内部类实现单例模式
 * 这种方式线程安全，调用效率高，实现了延时加载
 */

public class SingletonDemo4 {

    //静态内部类
    private static class SingletonClassInstance{
        private static final SingletonDemo4 instance =  new SingletonDemo4();
    }
    private SingletonDemo4(){}

    //方法没有同步，调用效率高
    public static SingletonDemo4 getInstance(){
        return SingletonClassInstance.instance;//调用时才加载静态内部类，并由静态内部类获取实例
    }
}</pre>

<ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">枚举单例 （最安全）</span></span></p>
<pre><code>*   &lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;枚举对象天然是单例的&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">天然防止反射和反序列化</span></span></li>
</ul>
</li>
</ul>
<pre class="brush:java;">
/*
 * 枚举模式实现单例，枚举没有延时加载
 */
public enum SingletonDemo5 {

    //这个枚举元素本身就是单例
    INSTANCE;
    //添加自己需要的操作
    public void singletonOperation(){
    }
}</pre>

<pre><code>&lt;span id=&quot;docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7&quot;&gt;&lt;span style=&quot;font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;&quot;&gt;如何选用&lt;/span&gt;&lt;/span&gt;
</code></pre><ul>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">单例对象 占用资源少 不需要延时加载：枚举 好于 饿汉</span></span></p>
</li>
<li><p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">单例对象 占用资源多 需要延时加载：静态内部类 好于 懒汉</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">问题</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(152, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&nbsp;&nbsp; &nbsp;</span><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/Client2.java" target="_blank" rel="external">反射破解除枚举外的单例模式，</a>（<a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/SingletonDemo6.java" target="_blank" rel="external">在构造器中判断实例是否为空</a>，不是的话抛出异常，不初始化新实例）</span></span></p>
<p><span id="docs-internal-guid-0a891e64-27e9-c0b1-bd6e-8d7ca9e765e7"><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&nbsp;&nbsp; &nbsp;</span><span style="font-size: 14.6666666666667px; font-family: Arial; color: rgb(0, 0, 0); vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/Client2.java" target="_blank" rel="external">反序列化破解除枚举外的单例模式</a>。（<a href="https://github.com/godlzr/GOF23_DesignPattern/blob/master/src/com/godlzr/GOF23/singleton/SingletonDemo6.java" target="_blank" rel="external">使用 readResolve() 防止</a>）。</span></span></p>
</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2015-08-13</span><i class="fa fa-tag"></i><a href="/categories/Creational-Patterns/" title="Creational Patterns" class="tag">Creational Patterns </a></div></div></div></div><div class="share"><div class="evernote"> <a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"> <a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"> <a href="http://twitter.com/home?status=,http://godlzr.com/2015/08/13/singleton/,1285 Richmond RD,1.Singleton 单例模式,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2015/08/14/factor-builder-prototype/" title="2. Factor, Builder, Prototype 工厂模式, 建造者模式和原型模式" class="btn">prev_post</a></li><li class="next pagbuttons"><a role="navigation" href="/2015/08/12/ielts-listening/" title="[转]大总结：雅思听力答案的写法" class="btn">next_post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>